<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Formulario Deportivo</title>
Â  <style>
Â  Â  /*...Estilo CSS...*/
    #graficoDeTorta {
        width: 100%;
        max-width: 450px;
        margin: 25px auto;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
        min-height: 250px;
    }

    body {
        font-family: Arial, sans-serif;
        background: url('https://img.freepik.com/vector-premium/fondo-pelotas-deporte-banner-plano-transparente-pelotas-futbol-baloncesto-futbol-beisbol_176516-1589.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        padding: 20px;
        margin: 0;
    }

    form {
        background: white;
        padding: 25px;
        border-radius: 12px;
        max-width: 450px;
        margin: auto;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h2 {
        text-align: center;
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #333;
        background: white;
    }

    label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
        color: #333;
    }

    input[type="text"] {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 1rem;
        transition: border-color 0.2s ease;
    }

    input[type="text"]:focus {
        border-color: #0078d7;
        outline: none;
    }

    input[type="text"]:invalid:not(:focus):not(:placeholder-shown) {
        border-color: red;
    }

    p {
        margin-top: 20px;
        font-weight: bold;
        color: #333;
       
    }

    label input[type="checkbox"],
    label input[type="radio"] {
        margin-right: 8px;
        transform: scale(1.2);
        vertical-align: middle;
    }

    button {
        margin-top: 25px;
        padding: 12px;
        width: 100%;
        background: #0078d7;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
    }

    button:hover {
        background: #005fa3;
    }

    #mensaje {
        display: none;
        text-align: center;
        background: #e7ffe7;
        border: 1px solid #80c780;
        color: #2e7d32;
        padding: 20px;
        border-radius: 8px;
        max-width: 450px;
        margin: 25px auto;
    }

    #mensaje button {
        width: auto;
        padding: 10px 20px;
        margin-top: 10px;
        background: #0078d7;
        border-radius: 5px;
    }

    #mensaje button:hover {
        background: #005fa3;
    }

    /*Ajustes para el responsive*/
    @media (max-width: 500px) {
        body {
            padding: 15px;
        }
        form {
            padding: 20px;
            border-radius: 10px;
        }
        h2 {
            font-size: 1.3rem;
        }
        input[type="text"] {
            font-size: 0.95rem;
        }
        button {
            font-size: 0.95rem;
            padding: 10px;
        }
    }
Â  </style>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

</head>
<body>

Â  <h2>Formulario Deportivo</h2>

Â  <form id="miFormulario" method="POST" action="https://script.google.com/macros/s/AKfycbwQHXinB4Muv2NglKTBsRj5x2ZPxHGwdy_bY-m4VjbMjPAEmrzLZK7N-w-IXQo29xhb/exec">
Â  Â  <label for="nombres">Nombres:</label>
Â  Â  <input type="text" id="nombres" name="nombres" required pattern="[A-Za-zÃ¡Ã©Ã­Ã³ÃºÃ±ÃÃ‰ÃÃ“ÃšÃ‘\s]+" title="Solo se permiten letras y espacios." >

Â  Â  <label for="apellidos">Apellidos:</label>
Â  Â  <input type="text" id="apellidos" name="apellidos" required pattern="[A-Za-zÃ¡Ã©Ã­Ã³ÃºÃ±ÃÃ‰ÃÃ“ÃšÃ‘\s]+" title="Solo se permiten letras y espacios." >

Â  Â  <p>Â¿QuÃ© deportes practicas?</p>
Â  Â  <label><input type="checkbox" name="deporte" value="FÃºtbol"> FÃºtbol</label>
Â  Â  <label><input type="checkbox" name="deporte" value="BÃ¡squetbol"> BÃ¡squetbol</label>
Â  Â  <label><input type="checkbox" name="deporte" value="Voleibol"> Voleibol</label>
    &nbsp; 
    <label><input type="checkbox" name="deporte" value="Todos"> Todos los Anteriores</label>

Â  Â  <p>Â¿CuÃ¡l te gusta mÃ¡s?</p>
Â  Â  <label><input type="radio" name="gusto" value="Solo fÃºtbol" required> Solo fÃºtbol</label>
Â  Â  <label><input type="radio" name="gusto" value="Solo bÃ¡squetbol"> Solo bÃ¡squetbol</label>
Â  Â  <label><input type="radio" name="gusto" value="Solo voleibol"> Solo voleibol</label>
Â  Â  <label><input type="radio" name="gusto" value="FÃºtbol y bÃ¡squetbol"> FÃºtbol y bÃ¡squetbol</label>
Â  Â  <label><input type="radio" name="gusto" value="FÃºtbol y voleibol"> FÃºtbol y voleibol</label>
Â  Â  <label><input type="radio" name="gusto" value="BÃ¡squet y voleibol"> BÃ¡squet y voleibol</label>
    &nbsp; 
    <label><input type="radio" name="gusto" value="Todos"> Todos los anteriores</label>

Â  Â  <button type="submit">Enviar</button>
Â  </form>

Â  <div id="mensaje">
Â  Â  <h3>âœ… Â¡Gracias por participar!</h3>
Â  Â  <p>Tus respuestas fueron registradas correctamente.</p>
Â  Â  <button onclick="window.location.reload()">Volver</button>
Â  </div>

    <div id="graficoDeTorta">
        <h3>ðŸ“Š Resultados de Gustos Deportivos</h3>
        <div id="piechart" style="width: 100%; height: 200px;">Cargando grÃ¡fico...</div>
    </div>


Â  <script> 

    //---Formulario(POST)---
Â  Â  const form = document.getElementById("miFormulario");
Â  Â  const mensaje = document.getElementById("mensaje");

Â  Â  form.addEventListener("submit", async (e) => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  
    
      const data = new FormData();
      const deportes = [];
Â  Â  Â  document.querySelectorAll('input[name="deporte"]:checked').forEach(chk => deportes.push(chk.value));

Â  Â  Â  data.append("nombres", form.nombres.value);
Â  Â  Â  data.append("apellidos", form.apellidos.value);
Â  Â  Â  data.append("deporte", deportes.join(", "));
Â  Â  Â  data.append("gusto", form.gusto.value);

Â  Â  Â  try {
Â  Â  Â  Â  const respuesta = await fetch("https://script.google.com/macros/s/AKfycbwQHXinB4Muv2NglKTBsRj5x2ZPxHGwdy_bY-m4VjbMjPAEmrzLZK7N-w-IXQo29xhb/exec", { method: "POST", body: data });
Â  Â  Â  Â  
        if (respuesta.ok) {
Â  Â  Â  Â  Â  form.style.display = "none";
Â  Â  Â  Â  Â  mensaje.style.display = "block";
            // Llama a la funciÃ³n de actualizaciÃ³n del grÃ¡fico inmediatamente despuÃ©s de enviar
            updateChart(); 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("OcurriÃ³ un error al enviar. Intenta nuevamente.");
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  alert("Error de conexiÃ³n. Revisa tu internet o el enlace del script.");
Â  Â  Â  }
Â  Â  });


    // ---Diagrama de Torta---

    // Cargo la librerÃ­a de Google Charts.
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(initializeChart); // Llamo a la funciÃ³n de inicializaciÃ³n al cargarse.

    function initializeChart() {
        // Llamo a la funciÃ³n de actualizaciÃ³n al cargar la pÃ¡gina
        updateChart(); 
        
        // Configuro la actualizaciÃ³n automÃ¡tica cada 5 segundos (5000 milisegundos) para que se actualice solo
        setInterval(updateChart, 5000); 
    }

    async function updateChart() {
        try {
            // Llamo la API de lectura (doGet) que cree en Apps Script
            const response = await fetch("https://script.google.com/macros/s/AKfycbwQHXinB4Muv2NglKTBsRj5x2ZPxHGwdy_bY-m4VjbMjPAEmrzLZK7N-w-IXQo29xhb/exec");
            
            if (!response.ok) {
                throw new Error("Error al obtener los datos del grÃ¡fico: " + response.statusText);
            }
            
            const dataCounts = await response.json();

            if (dataCounts.error) {
                document.getElementById('piechart').innerHTML = 'AÃºn no hay datos para el grÃ¡fico.';
                return;
            }

            // Convierto los datos de conteo que son JSON a un formato de tabla que Google Charts pueda interpretar
            const dataArray = [['Gusto', 'Votos']];
            for (const key in dataCounts) {
                if (dataCounts.hasOwnProperty(key)) {
                    dataArray.push([key, dataCounts[key]]);
                }
            }

            const dataTable = google.visualization.arrayToDataTable(dataArray);

            const options = {
                title: 'DistribuciÃ³n de Gustos Deportivos',
                pieHole: 0.4, 
                height: 200,
                width: '100%',
                legend: { position: 'bottom' }
            };

            // Dibujo el grÃ¡fico
            const chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(dataTable, options);

        } catch (error) {
            console.error("Error en la actualizaciÃ³n del grÃ¡fico:", error);
            document.getElementById('piechart').innerHTML = 'Error al cargar los datos del grÃ¡fico. Verifica la URL de tu API.';
        }
    }

Â  </script>

</body>
</html>








